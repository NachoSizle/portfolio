---
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import BackgroundGradients from '../components/BackgroundGradients.astro';
import { getLangFromUrl } from '../i18n/utils';
import '../styles/global.css';

export interface Props {
  title: string;
  description: string;
  image?: string;
}

const {
  title,
  description,
  image = "/portfolio/placeholder-social.jpg",
} = Astro.props;

const lang = getLangFromUrl(Astro.url);
const canonicalURL = new URL(Astro.url.pathname, Astro.site);

// Extraer el path sin /portfolio y sin idioma
const basePath = '/portfolio';
let pathWithoutBase = Astro.url.pathname.replace(/^\/portfolio/, '');
pathWithoutBase = pathWithoutBase.replace(/^\/(en|es)/, '');

// URLs alternativas para SEO multiidioma
const esUrl = new URL(`${basePath}${pathWithoutBase}`, Astro.site);
const enUrl = new URL(`${basePath}/en${pathWithoutBase}`, Astro.site);
const alternateUrl = lang === 'es' ? enUrl : esUrl;
---

<!doctype html>
<html lang={lang}>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width" />
    <link rel="icon" type="image/png" href="/portfolio/favicon.png" />
    <meta name="generator" content={Astro.generator} />

    <script is:inline>
      const theme = (() => {
        if (typeof localStorage !== 'undefined' && localStorage.getItem('theme')) {
          return localStorage.getItem('theme');
        }
        if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
          return 'dark';
        }
        return 'light';
      })();

      if (theme === 'light') {
        document.documentElement.classList.remove('dark');
      } else {
        document.documentElement.classList.add('dark');
      }
      // We are not setting the theme in localStorage here to avoid a flicker
    </script>

    <!-- SEO -->
    <title>{title}</title>
    <meta name="description" content={description} />
    <link rel="canonical" href={canonicalURL} />
    
    <!-- Alternate languages for SEO -->
    <link rel="alternate" hreflang="es" href={esUrl} />
    <link rel="alternate" hreflang="en" href={enUrl} />
    <link rel="alternate" hreflang="x-default" href={esUrl} />

    <!-- Open Graph -->
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:url" content={canonicalURL} />
    <meta property="og:image" content={new URL(image, Astro.site)} />
    <meta property="og:type" content="website" />
    <meta property="og:locale" content={lang === 'es' ? 'es_ES' : 'en_US'} />
    <meta property="og:locale:alternate" content={lang === 'es' ? 'en_US' : 'es_ES'} />

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content={title} />
    <meta name="twitter:description" content={description} />
    <meta name="twitter:image" content={new URL(image, Astro.site)} />

    <!-- Umami -->
    <script is:inline defer src="https://cloud.umami.is/script.js" data-website-id="7e7bb8f2-01ba-436c-bc5e-8a999ddb1891"></script>
  </head>
  <body class="bg-gradient-to-br from-gray-50 via-white to-blue-50/30 dark:from-gray-950 dark:via-gray-900 dark:to-blue-950/30">
    <BackgroundGradients />
    <Header />
    <main class="relative z-10">
      <slot />
    </main>
    <Footer />
  </body>
</html>
